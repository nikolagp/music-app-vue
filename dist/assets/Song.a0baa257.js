import{_ as S,q as C,u,k as _,x as h,s as g,y as b,z as k,r as d,o as i,c as l,a as e,l as P,n as p,t as r,p as f,h as D,w as q,f as E,A as I,F as z,g as B,b as y}from"./index.6f317fed.js";const L={name:"Song",data(){return{song:{},commentSchema:{comment:"required|min:9|max:200"},comment_in_submission:!1,comment_show_alert:!1,comment_alert_variant:"bg-blue-500",comment_alert_msg:"Please wait! We are logging you in.",comments:[],sort:"1"}},methods:{...C(u,["newSong"]),async submitComment(s,{resetForm:o}){this.comment_in_submission=!0,this.comment_show_alert=!0,this.comment_alert_variant="bg-blue-500",this.comment_alert_msg="Please wait! Your comment is being processed.";const m={content:s.comment,datePosted:new Date().toISOString().slice(0,16).split("T").join(" "),sid:this.$route.params.id,name:_.currentUser.displayName,uid:_.currentUser.uid};try{await h.add(m)}catch{this.comment_in_submission=!1,this.comment_alert_variant="bg-red-500",this.comment_alert_msg="Some error occured. Please try again.";return}this.song.comment_count+=1,await g.doc(this.$route.params.id).update({comment_count:this.song.comment_count}),this.getComments(),this.comment_alert_variant="bg-green-500",this.comment_alert_msg="Comment added!",o()},async getComments(){const s=await h.where("sid","==",this.$route.params.id).get();this.comments=[],s.forEach(o=>[this.comments.push({docID:o.id,...o.data()})])}},computed:{...b(u,["playing"]),...b(k,["userLoggedIn"]),sortedComments(){return this.comments.slice().sort((s,o)=>this.sort==="1"?new Date(o.datePosted)-new Date(s.datePosted):new Date(s.datePosted)-new Date(o.datePosted))}},watch:{sort(s){s!==this.$route.query.sort&&this.$router.push({query:{sort:s}})}},async beforeRouteEnter(s,o,m){const c=await g.doc(s.$route.params.id).get();m(t=>{if(!c.exists){t.$router.push({name:"home"});return}const{sort:a}=t.$route.query;t.sort=a==="1"||a==="2"?a:"1",t.song=c.data(),t.getComments()})}},M={class:"relative w-full mb-8 text-center text-white py-14"},N=e("div",{class:"box-border absolute inset-0 w-full h-full bg-contain music-bg",style:{"background-image":"url(/assets/img/song-header.png)"}},null,-1),U={class:"container flex items-center mx-auto"},V={class:"z-50 ml-8 text-left"},A={class:"text-3xl font-bold"},F={class:"container mx-auto mt-6",id:"#comments"},O={class:"relative flex flex-col bg-white border border-gray-200 rounded"},Y={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},j={class:"card-title"},R=e("i",{class:"float-right text-2xl text-green-400 fa fa-comments"},null,-1),T={class:"p-6"},W=["disabled"],G=e("option",{value:"1"},"Latest",-1),H=e("option",{value:"2"},"Oldest",-1),J=[G,H],K={class:"container mx-auto"},Q={class:"mb-5"},X={class:"font-bold"};function Z(s,o,m,c,t,a){const x=d("vee-field"),w=d("ErrorMessage"),v=d("vee-form");return i(),l("main",null,[e("section",M,[N,e("div",U,[e("button",{onClick:o[0]||(o[0]=P(n=>s.newSong(t.song),["prevent"])),type:"button",class:"z-50 w-24 h-24 text-3xl text-black bg-white rounded-full focus:outline-none"},[e("i",{class:p(["fas",{"fa-play":!s.playing,"fa-pause":s.playing}])},null,2)]),e("div",V,[e("div",A,r(t.song.modified_name),1),e("div",null,r(t.song.genre),1)])])]),e("section",F,[e("div",O,[e("div",Y,[e("span",j,"Comments ("+r(t.song.comment_count)+") ",1),R]),e("div",T,[t.comment_show_alert?(i(),l("div",{key:0,class:p(["p-4 mb-4 font-bold text-center text-white rounded",t.comment_alert_variant])},r(t.comment_alert_msg),3)):f("",!0),s.userLoggedIn?(i(),D(v,{key:1,"validation-schema":t.commentSchema,onSubmit:a.submitComment},{default:q(()=>[y(x,{as:"textarea",type:"text",name:"comment",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded mb-4",placeholder:"Your comment here..."}),y(w,{class:"text-red-600",name:"comment"}),e("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600 block",disabled:t.comment_in_submission}," Submit ",8,W)]),_:1},8,["validation-schema","onSubmit"])):f("",!0),E(e("select",{"onUpdate:modelValue":o[1]||(o[1]=n=>t.sort=n),class:"block mt-4 py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded"},J,512),[[I,t.sort]])])])]),e("ul",K,[(i(!0),l(z,null,B(a.sortedComments,n=>(i(),l("li",{class:"p-6 border border-gray-200 bg-gray-50",key:n.docID},[e("div",Q,[e("div",X,r(n.name),1),e("time",null,r(n.datePosted),1)]),e("p",null,r(n.content),1)]))),128))])])}const ee=S(L,[["render",Z]]);export{ee as default};
